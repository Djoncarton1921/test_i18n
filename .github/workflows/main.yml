name: Translate locales js

on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Read target languages from file
        id: read-languages
        run: |
          echo "::set-output name=languages::$(cat locales-list.txt)"
      - name: Translate with Microsoft Translator
        id: translate
        run: |
          mkdir -p src/i18n
          for file in src/i18n/ua/*.js; do
            filename=$(basename "$file")
            file_content=$(cat "$file")
            translated_text=$(curl -s -X POST "https://blanball.cognitiveservices.azure.com/translator/text/v3.0/translate?api-version=3.0&from=uk&to=$(cat locales-list.txt)" \
              -H "Content-Type: application/json" \
              -H "Ocp-Apim-Subscription-Key: a32cf006d7184a00bb73f23b5a9d154a" \
              -d "[
                {
                  \"text\": \"$file_content\"
                }
              ]")
            translations=$(echo "$translated_text" | jq -r '.[].translations[]')
            while IFS= read -r translation; do
              lang=$(echo "$translation" | jq -r '.to')
              translated=$(echo "$translation" | jq -r '.text')
              lang_dir="src/i18n/$lang"
              mkdir -p "$lang_dir"
              echo "$translated" > "$lang_dir/$filename"
            done <<< "$translations"
          done