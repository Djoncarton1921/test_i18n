name: Translate locales js

on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Read target languages from file
        id: read-languages
        run: |
          echo "::set-output name=languages::$(cat locales-list.txt)"
      - name: Translate with Microsoft Translator
        id: translate
        run: |
          for lang in ${{ steps.read-languages.outputs.languages }}; do
            mkdir -p src/i18n/$lang
            for file in src/i18n/ua/*.js; do
              filename=$(basename "$file")
              base64_text=$(base64 -w 0 "$file")
              echo $base64_text
              translated_text=$(curl -s -X POST \
                -H "Content-Type: application/json" \
                -H "Ocp-Apim-Subscription-Key: a32cf006d7184a00bb73f23b5a9d154a" \
                -d '[
                  {
                    "text": "'"$base64_text"'",
                    "to": "'"$lang"'"
                  }
                ]' \
                "https://api.cognitive.microsofttranslator.com/" \
                | jq -r '.[0].translations[0].text' | base64 -d)
              echo "$translated_text" > "src/i18n/$lang/$filename"
            done
          done
